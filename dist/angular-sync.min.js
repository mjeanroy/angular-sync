!function(n,r,t,e){"use strict";var o=function(){try{return t.module("angularSync",["ngResource"])}catch(n){return t.module("angularSync",[])}}();o.constant("AngularSyncMode",{ABORT:"abort",PREVENT:"prevent",FORCE:"force"}),o.provider("AngularSync",["AngularSyncMode",function(n){var r={preventError:!0,timeout:-1,modes:{GET:n.ABORT,POST:n.PREVENT,PUT:n.PREVENT,PATCH:n.PREVENT,DELETE:n.PREVENT,HEAD:n.FORCE}};this.timeout=function(n){return r.timeout=n,this},this.mode=function(e,o){var u=n[o.toUpperCase()];if(!t.isDefined(u))throw new Error('Mode "'+o+'" is not valid');return r.modes[e.toUpperCase()]=u,this},this.allowError=function(){r.preventError=!1},this.$get=function(){return{timeout:function(){return r.timeout},mode:function(n){return r.modes[n.toUpperCase()]},preventError:function(){return r.preventError}}}}]),o.factory("AngularSyncTimeout",["AngularSync",function(n){return{isOutdated:function(r,t){var e=n.timeout();if(0>=e)return!1;var o=new Date(r).getTime(),u=new Date(t).getTime();return Math.abs(u-o)>=e}}}]),o.factory("AngularSyncHistory",["AngularSyncTimeout",function(n){var r={},t=function(){return(new Date).getTime()},e=function(n,r){return r+"_"+n},o=function(n,r,t){for(var e=0,o=n.length;o>e;++e)if(r.call(t,n[e],e,n))return e;return-1},u=function(n){return function(r){return n===r.config}},i=function(n,r,t){for(var e=[],o=0,u=n.length;u>o;++o)r.call(t,n[o],o,n)||e.push(n[o]);return e};return{add:function(n){var o=n.ngSync,u=o.id,i=e(u,n.method),c=r[i]=r[i]||[];return c.push({timestamp:t(),config:n}),this},remove:function(n){var t=n.ngSync,i=t.id,c=e(i,n.method),a=r[c]||[],f=o(a,u(n));return-1!==f&&a.splice(f,1),this},pendings:function(n,t){var o=e(n,t);return(r[o]||[]).slice()},clear:function(n,t){var o=e(n,t);return r[o]=[],this},contains:function(o,u){var c=e(o,u),a=t(),f=r[c]=i(r[c]||[],function(r){return n.isOutdated(r.timestamp,a)});return f.length>0}}}]),o.factory("AngularSyncStrategies",["AngularSync","AngularSyncMode","AngularSyncHistory","$q",function(n,r,e,o){var u={};return u[r.PREVENT]=function(r){var t=r.ngSync;return e.contains(t.id,r.method)?(t.preventError=n.preventError(),o.reject(r)):(e.add(r),r)},u[r.FORCE]=function(n){return e.add(n),n},u[r.ABORT]=function(r){var o=r.ngSync,u=e.pendings(o.id,r.method);return t.forEach(u,function(r){var t=r.config.ngSync;t.preventError=n.preventError(),t.$q.resolve()}),e.clear(o.id,r.method).add(r),r},u}]),o.factory("AngularSyncInterceptor",["AngularSync","AngularSyncMode","AngularSyncHistory","AngularSyncStrategies","$q","$timeout",function(n,r,t,e,o,u){var i=function(n){var r=n.ngSync;t.remove(n),r.$timeout&&u.cancel(r.$timeout),r.$q.reject(),n.timeout=r.$timeout,delete r.$timeout,delete r.$q};return{request:function(r){var t=r.method,i=r.ngSync=r.ngSync||{};i.mode=i.mode||n.mode(t),i.id=i.id||r.url;var c=i.$q=o.defer(),a=c.promise,f=r.timeout;f&&(f>0?f=u(c.resolve,f,!1):f.then(c.resolve),i.$timeout=f);var s=function(){c=a=f=i=s=null};return a.then(s,s),r.timeout=a,e[i.mode](r)},response:function(n){return i(n.config||n),n},responseError:function(n){return i(n.config||n),o.reject(n)}}}]),o.config(["$httpProvider",function(n){n.interceptors.push("AngularSyncInterceptor")}]),o.config(["$provide","$injector",function(n,r){var e=function(n,r){var t=n.then;return n.then=function(e,o){var u=o;o&&(u=function(n,t,e,u){var i=u||n.config||n,c=i.ngSync||{};return c.preventError?r.reject(n):o.apply(this,arguments)});var i=Array.prototype.slice.call(arguments);return i[1]=u,t.apply(n,i)},n},o=function(n,r){return function(){return r.call(this,n.apply(this,arguments))}};n.decorator("$http",["$delegate","$q",function(n,r){var u=function(n){return e(n,r)},i=function(n){return o(n,u)},c=i(n);for(var a in n)t.isFunction(n[a])&&(c[a]=i(n[a]));return c}]),r.has("$resource")&&n.decorator("$resource",["$delegate","$q",function(n,r){var u=function(n){var t=e(n.$promise||n,r);return n.$promise?n.$promise=t:n=t,n},i=function(n){return o(n,u)},c=function(){var r=n.apply(n,arguments);for(var e in r)t.isFunction(r[e])&&(r[e]=i(r[e]));return r};return c}])}])}(window,document,window.angular,void 0);