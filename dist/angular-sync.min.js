!function(n,r,t){"use strict";var e=t.module("angularSync",[]);e.constant("AngularSyncMode",{ABORT:"abort",PREVENT:"prevent",FORCE:"force"}),e.provider("AngularSync",["AngularSyncMode",function(n){var r={timeout:-1,modes:{GET:n.ABORT,POST:n.PREVENT,PUT:n.PREVENT,PATCH:n.PREVENT,DELETE:n.PREVENT,HEAD:n.FORCE}};this.timeout=function(n){return r.timeout=n,this},this.mode=function(e,o){var u=n[o.toUpperCase()];if(!t.isDefined(u))throw new Error('Mode "'+o+'" is not valid');return r.modes[e.toUpperCase()]=u,this},this.$get=function(){return{timeout:function(){return r.timeout},mode:function(n){return r.modes[n.toUpperCase()]}}}}]),e.factory("AngularSyncTimeout",["AngularSync",function(n){return{isOutdated:function(r,t){var e=n.timeout();if(0>=e)return!1;var o=new Date(r).getTime(),u=new Date(t).getTime();return Math.abs(u-o)>=e}}}]),e.factory("AngularSyncHistory",["AngularSyncTimeout",function(n){var r={},t=function(){return(new Date).getTime()},e=function(n,r){return r+"_"+n},o=function(n,r,t){for(var e=0,o=n.length;o>e;++e)if(r.call(t,n[e],e,n))return e;return-1},u=function(n){return function(r){return n===r.config}},i=function(n,r,t){for(var e=[],o=0,u=n.length;u>o;++o)r.call(t,n[o],o,n)||e.push(n[o]);return e};return{add:function(n){var o=e(n.url,n.method),u=r[o]=r[o]||[];return u.push({timestamp:t(),config:n}),this},remove:function(n){var t=e(n.url,n.method),i=r[t]||[],c=o(i,u(n));return-1!==c&&i.splice(c,1),this},pendings:function(n,t){var o=e(n,t);return(r[o]||[]).slice()},clear:function(n,t){var o=e(n,t);return r[o]=[],this},contains:function(o,u){var c=e(o,u),a=t(),f=r[c]=i(r[c]||[],function(r){return n.isOutdated(r.timestamp,a)});return f.length>0}}}]),e.factory("AngularSyncInterceptor",["AngularSync","AngularSyncMode","AngularSyncHistory","$q","$timeout",function(n,r,e,o,u){var i={};return i[r.PREVENT]=function(n){return e.contains(n.url,n.method)?(n.ngSync.preventError=!0,o.reject(n)):(e.add(n),n)},i[r.FORCE]=function(n){return e.add(n),n},i[r.ABORT]=function(n){return t.forEach(e.pendings(n.url,n.method),function(n){n.config.ngSync.preventError=!0,n.config.ngSync.$q.resolve()}),e.clear(n.url,n.method).add(n),n},{request:function(r){var t,e,c,a=r.method,f=r.ngSync=r.ngSync||{},s=f.mode=f.mode||n.mode(a),m=f.$q=o.defer(),d=f.$promise=m.promise,l=r.timeout;l&&(l>0&&(e=o.defer(),c=e.promise,t=u(e.resolve,l,!1),l=c),f.$timeoutTask=t,f.$timeout=l,l.then(m.resolve));var g=function(){m=d=l=t=e=c=f=g=null};return c&&c.then(g,g),d.then(g,g),r.timeout=d,i[s](r)},response:function(n){var r=n.config,t=r.ngSync;return e.remove(r),t.$timeoutTask&&u.cancel(t.$timeoutTask),t.$q.reject(),n},responseError:function(n){var r=n.config||n,t=r.ngSync;return e.remove(r),t.$timeoutTask&&u.cancel(t.$timeoutTask),t.$q.reject(),o.reject(n)}}}]),e.config(["$httpProvider","$provide",function(n,r){n.interceptors.push("AngularSyncInterceptor"),r.decorator("$http",["$delegate","$q",function(n,r){var e=function(n){var t=n.then;return n.then=function(e,o){var u=o;o&&(u=function(n,t,e,u){var i=u||n.config||n;return i.ngSync.preventError?r.reject(n):o.apply(this,arguments)});var i=Array.prototype.slice.call(arguments);return i[1]=u,t.apply(n,i)},n},o=function(r){var t=n(r);return e(t)},u=function(n,r){return function(){var t=n[r].apply(n,arguments);return e(t)}};for(var i in n)t.isFunction(n[i])&&(o[i]=u(n,i));return o}])}])}(window,document,window.angular,void 0);